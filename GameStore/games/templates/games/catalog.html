{% extends 'base.html' %}
{% load static %}
{% load games_tags %}
{% block content%}
<div class="main-content-with-sidebar">
    <!-- Боковое меню с жанрами -->
    {% include 'games/sidebar.html' %}

    <!-- Основной контент -->
    <div class="content-main">
        <h1 class="page-title">{{title|upper}}</h1>
        <ul class="games-list">
            {% for g in games %}
            <li class="game-card">
                <div class="game-header">
                    <a href="{% url 'game_detail' g.slug %}" class="game-title-link">
                        <h2 class="game-title">{{g.title|capfirst}}</h2>
                    </a>
                    <span class="age-rating">{{g.age_rating|default:"18+"}}</span>
                </div>
                <div class="game-content">
                    <a href="{% url 'game_detail' g.slug %}" class="game-image-link">
                        <div class="game-image">
                            {% if g.image %}
                                <img src="{{ g.image.url }}" alt="{{g.title}}" class="game-img">
                            {% else %}
                                <img src="{% static 'images/default_game.jpg' %}" alt="{{g.title}}" class="game-img">
                            {% endif %}
                        </div>
                    </a>
                    <div class="game-details">
                        <p class="platform">{{g.platform|upper}}</p>
                        <p class="year">{{g.year_release}}</p>
                        <p class="genres">
                            {% for genre in g.genres.all %}
                                <span class="genre-tag">{{genre.name}}</span>
                            {% endfor %}
                        </p>
                        <div class="tags">
                            {% for tag in g.tags.all %}
                                <a href="{% url 'catalog_by_tag' tag.slug %}" class="game-tag">
                                    {{ tag.name }}
                                </a>
                            {% endfor %}
                        </div>
                        <p class="description">{{g.description}}</p>
                        {% if g.is_stock %}
                            <p class="price">{{g.price|floatformat:2}} ₽</p>
                        {% else %}
                            <p class="price_not_in_stock">Нет в наличии</p>
                        {% endif %}
                    </div>
                </div>
                {% if not forloop.last %}
                <hr class="divider">
                {% endif %}
            </li>    
            {% endfor %}
        </ul>

        <!-- Пагинация -->
        {% if page_obj.has_other_pages %}
        <nav class="list-pages">
            <ul>
                {% if page_obj.has_previous %}
                <li class="page-num">
                    <a href="?page={{ page_obj.previous_page_number }}">Назад</a>
                </li>
                {% endif %}
                
                {% for p in paginator.page_range %}
                    {% if page_obj.number == p %}
                    <li class="page-num page-num-selected">{{ p }}</li>
                    {% elif p >= page_obj.number|add:-2 and p <= page_obj.number|add:2 %}
                    <li class="page-num">
                        <a href="?page={{ p }}">{{ p }}</a>
                    </li>
                    {% endif %}
                {% endfor %}
                
                {% if page_obj.has_next %}
                <li class="page-num">
                    <a href="?page={{ page_obj.next_page_number }}">Вперед</a>
                </li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}
    </div>
</div>
{% endblock %}