{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container">
    <h1 class="page-title">{{title}}</h1>
    
    <div class="main-content-with-sidebar">
        <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å –∂–∞–Ω—Ä–∞–º–∏ -->
        <aside class="sidebar">
            <h3>–ñ–∞–Ω—Ä—ã</h3>
            <ul class="genre-list">
                {% for genre in genres %}
                <li>
                    <a href="{% url 'catalog_by_genre' genre.slug %}" 
                       class="genre-link {% if current_genre and current_genre.slug == genre.slug %}active{% endif %}">
                        {{ genre.name }}
                    </a>
                </li>
                {% endfor %}
            </ul>
            
            <h3 style="margin-top: 30px;">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–µ–≥–∏</h3>
            <div class="tags-cloud">
                {% for tag in tags %}
                <a href="{% url 'catalog_by_tag' tag.slug %}" class="game-tag">
                    {{ tag.name }}
                </a>
                {% endfor %}
            </div>
        </aside>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <main class="content-main">
            <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –µ—Å–ª–∏ –Ω–µ—Ç –∏–≥—Ä –≤ –Ω–∞–ª–∏—á–∏–∏ -->
            {% if not games %}
            <div class="no-games-message" style="text-align: center; padding: 50px 20px;">
                <p style="font-size: 1.5em; color: #ff0000; margin-bottom: 20px;">
                    üòî –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —Å–µ–π—á–∞—Å –Ω–µ—Ç –∏–≥—Ä –≤ –Ω–∞–ª–∏—á–∏–∏
                </p>
                <p style="margin-bottom: 30px; color: #cccccc; font-size: 1.1em;">
                    –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–π—Ç–∏ –ø–æ–∑–∂–µ –∏–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–æ–ª–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ –∏–≥—Ä.
                </p>
                <a href="{% url 'catalog' %}" class="btn-primary" style="font-size: 1.1em; padding: 15px 30px;">
                    –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥
                </a>
            </div>
            {% else %}
                <!-- –°–ø–∏—Å–æ–∫ –∏–≥—Ä (—Ç–æ–ª—å–∫–æ –≤ –Ω–∞–ª–∏—á–∏–∏) -->
                <ul class="games-list">
                    {% for game in games %}
                    <li class="game-card">
                        <div class="game-content">
                            <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–≥—Ä—ã -->
                            <div class="game-image">
                                <a href="{% url 'game_detail' game.slug %}" class="game-image-link">
                                    {% if game.image %}
                                    <img src="{{ game.image.url }}" alt="{{ game.title }}" class="game-img">
                                    {% else %}
                                    <img src="{% static 'games/images/default_game.jpg' %}" alt="{{ game.title }}" class="game-img">
                                    {% endif %}
                                </a>
                            </div>
                            
                            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–≥—Ä–µ -->
                            <div class="game-details">
                                <div class="game-header">
                                    <a href="{% url 'game_detail' game.slug %}" class="game-title-link">
                                        <h2 class="game-title">{{ game.title }}</h2>
                                    </a>
                                    {% if game.age_rating %}
                                    <span class="age-rating">{{ game.age_rating }}</span>
                                    {% endif %}
                                </div>
                                
                                <div class="platform">{{ game.platform }}</div>
                                <div class="year">–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞: {{ game.year_release }}</div>
                                
                                {% if game.description %}
                                <p class="description">{{ game.description|truncatewords:30 }}</p>
                                {% endif %}
                                
                                <!-- –ñ–∞–Ω—Ä—ã –∏–≥—Ä—ã -->
                                <div class="game-genres">
                                    {% for genre in game.genres.all %}
                                    <span class="genre-tag">{{ genre.name }}</span>
                                    {% endfor %}
                                </div>
                                
                                <!-- –¢–µ–≥–∏ –∏–≥—Ä—ã -->
                                <div class="game-tags">
                                    {% for tag in game.tags.all %}
                                    <a href="{% url 'catalog_by_tag' tag.slug %}" class="game-tag">
                                        {{ tag.name }}
                                    </a>
                                    {% endfor %}
                                </div>
                                
                                <hr class="divider">
                                
                                <!-- –¶–µ–Ω–∞ –∏ –∫–Ω–æ–ø–∫–∏ -->
                                <div class="game-footer" style="display: flex; justify-content: space-between; align-items: center;">
                                    <div class="price">{{ game.price }} ‚ÇΩ</div>
                                    
                                    <div class="game-actions">
                                        {% if user.is_authenticated %}
                                        <form method="post" action="{% url 'add_to_cart' game.slug %}" class="add-to-cart-form">
                                            {% csrf_token %}
                                            <button type="submit" class="btn-success">–í –∫–æ—Ä–∑–∏–Ω—É</button>
                                        </form>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            {% endif %}
            
            <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –∏–≥—Ä—ã) -->
            {% if games and page_obj.has_other_pages %}
            <nav class="list-pages">
                <ul>
                    {% if page_obj.has_previous %}
                    <li class="page-num">
                        <a href="?page={{ page_obj.previous_page_number }}">–ù–∞–∑–∞–¥</a>
                    </li>
                    {% endif %}
                    
                    {% for p in paginator.page_range %}
                        {% if page_obj.number == p %}
                        <li class="page-num page-num-selected">{{ p }}</li>
                        {% elif p >= page_obj.number|add:-2 and p <= page_obj.number|add:2 %}
                        <li class="page-num">
                            <a href="?page={{ p }}">{{ p }}</a>
                        </li>
                        {% endif %}
                    {% endfor %}
                    
                    {% if page_obj.has_next %}
                    <li class="page-num">
                        <a href="?page={{ page_obj.next_page_number }}">–í–ø–µ—Ä–µ–¥</a>
                    </li>
                    {% endif %}
                </ul>
            </nav>
            {% endif %}
        </main>
    </div>
</div>
{% endblock %}